@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    --background: 40 23% 97%; /* Warm off-white #FAFAF8 */
    --foreground: 0 0% 13%; /* Soft black #212121 */
    --card: 60 9% 98%; /* Very light warm gray #FCFCFB */
    --card-foreground: 0 0% 13%;
    --popover: 60 9% 98%;
    --popover-foreground: 0 0% 13%;
    --primary: 0 0% 25%; /* Dark gray #404040 */
    --primary-foreground: 0 0% 98%;
    --secondary: 0 0% 96%; /* Light gray #F5F5F5 */
    --secondary-foreground: 0 0% 15%;
    --muted: 0 0% 95%; /* Soft gray #F2F2F2 */
    --muted-foreground: 0 0% 45%; /* Medium gray #737373 */
    --accent: 0 0% 93%; /* Light accent gray #EDEDED */
    --accent-foreground: 0 0% 13%;
    --destructive: 0 72% 51%; /* Softer red #E74C3C */
    --destructive-foreground: 0 0% 98%;
    --border: 0 0% 90%; /* Soft border #E5E5E5 */
    --input: 0 0% 91%; /* Input background #E8E8E8 */
    --ring: 0 0% 40%; /* Focus ring #666666 */
    --radius: 0.5rem;
  }

  .dark {
    --background: 0 0% 9%; /* Soft dark #171717 */
    --foreground: 0 0% 90%; /* Softer white #E5E5E5 */
    --card: 0 0% 12%; /* Elevated dark #1F1F1F */
    --card-foreground: 0 0% 90%;
    --popover: 0 0% 15%; /* Higher elevation #262626 */
    --popover-foreground: 0 0% 90%;
    --primary: 0 0% 75%; /* Light gray #BFBFBF */
    --primary-foreground: 0 0% 9%;
    --secondary: 0 0% 20%; /* Softer dark gray #333333 */
    --secondary-foreground: 0 0% 90%;
    --muted: 0 0% 25%; /* Muted gray #404040 */
    --muted-foreground: 0 0% 65%; /* Softer muted text #A6A6A6 */
    --accent: 0 0% 30%; /* Accent gray #4D4D4D */
    --accent-foreground: 0 0% 95%;
    --destructive: 0 65% 48%; /* Softer red #C9302C */
    --destructive-foreground: 0 0% 95%;
    --border: 0 0% 18%; /* Subtle border #2E2E2E */
    --input: 0 0% 20%; /* Input background #333333 */
    --ring: 0 0% 60%; /* Focus ring #999999 */
  }
}

@layer base {
  * {
    @apply border-border;
  }
  body {
    @apply bg-background text-foreground;
    font-feature-settings: "rlig" 1, "calt" 1;
    overflow-y: scroll;
    transition: background-color 0.3s ease, color 0.3s ease;
  }
}

/* Enhanced Focus Visibility - WCAG 2.1 AA Compliance */
@layer base {
  /* Remove default focus outline */
  *:focus {
    outline: none;
  }

  /* Custom focus-visible styles for keyboard navigation */
  *:focus-visible {
    outline: 2px solid hsl(var(--primary));
    outline-offset: 2px;
    border-radius: 4px;
  }

  /* Links and buttons - more prominent focus */
  a:focus-visible,
  button:focus-visible {
    outline: 2px solid hsl(var(--primary));
    outline-offset: 3px;
    box-shadow: 0 0 0 4px hsl(var(--primary) / 0.1);
  }

  /* Input fields - distinct focus style */
  input:focus-visible,
  textarea:focus-visible,
  select:focus-visible {
    outline: 2px solid hsl(var(--ring));
    outline-offset: 0;
    box-shadow: 0 0 0 4px hsl(var(--ring) / 0.1);
  }

  /* Card and interactive components */
  [role="button"]:focus-visible,
  [role="link"]:focus-visible,
  [tabindex]:not([tabindex="-1"]):focus-visible {
    outline: 2px solid hsl(var(--primary));
    outline-offset: 2px;
  }

  /* Navigation menu items */
  [role="menuitem"]:focus-visible,
  [role="menuitemradio"]:focus-visible,
  [role="menuitemcheckbox"]:focus-visible {
    outline: 2px solid hsl(var(--primary));
    outline-offset: -2px;
    background-color: hsl(var(--accent));
  }
}

/* Prose customization - Velog style */
.prose {
  --tw-prose-body: hsl(var(--foreground));
  --tw-prose-headings: hsl(var(--foreground));
  --tw-prose-lead: hsl(var(--foreground));
  --tw-prose-links: hsl(var(--primary));
  --tw-prose-bold: hsl(var(--foreground));
  --tw-prose-counters: hsl(var(--muted-foreground));
  --tw-prose-bullets: hsl(var(--muted-foreground));
  --tw-prose-hr: hsl(var(--border));
  --tw-prose-quotes: hsl(var(--foreground));
  --tw-prose-quote-borders: hsl(var(--border));
  --tw-prose-captions: hsl(var(--muted-foreground));
  --tw-prose-code: hsl(var(--foreground));
  --tw-prose-pre-code: hsl(var(--foreground));
  --tw-prose-pre-bg: hsl(var(--card));
  --tw-prose-th-borders: hsl(var(--border));
  --tw-prose-td-borders: hsl(var(--border));
}

/* Velog-style responsive typography */
@media (max-width: 768px) {
  .prose p,
  .prose li {
    font-size: 17px;
    line-height: 1.8;
  }
  .prose h1 {
    font-size: 2rem;
  }
  .prose h2 {
    font-size: 1.75rem;
  }
  .prose h3 {
    font-size: 1.375rem;
  }
}

/* Ensure strong and bold text are properly styled */
.prose strong,
.prose b {
  font-weight: 700 !important;
  color: var(--tw-prose-bold);
}

/* Enhanced code block styling for new component */
code[class*="language-"],
pre[class*="language-"] {
  @apply text-foreground;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;
  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;
  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
  font-family: ui-monospace, SFMono-Regular, "SF Mono", Consolas, "Liberation Mono", Menlo, monospace;
}

/* Remove default pre styling since we use custom component */
pre[class*="language-"] {
  background: transparent;
  padding: 0;
  margin: 0;
  overflow: visible;
  border: none;
  border-radius: 0 !important;
}

/* Code block styling with One Dark Pro theme */
.prose pre {
  @apply bg-[#FAFAFA] dark:bg-[#282C34] m-0 border-0;
  border-radius: 0 !important;
  overflow-x: auto !important;
  max-width: 100%;
}

.prose pre code {
  display: block;
  width: max-content;
  min-width: 100%;
}

.prose :not(pre) > code {
  @apply bg-[#F3F4F6] dark:bg-[#2C323C] text-[#383A42] dark:text-[#ABB2BF] px-1.5 py-0.5 rounded;
}

/* One Dark Pro theme syntax highlighting */
.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
  @apply text-[#6B7280] dark:text-[#6B7280];
}

.token.punctuation {
  @apply text-[#5C6370] dark:text-[#ABB2BF];
}

.token.property,
.token.tag,
.token.boolean,
.token.number,
.token.constant,
.token.symbol,
.token.deleted {
  @apply text-[#D19A66] dark:text-[#D19A66];
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
  @apply text-[#50A14F] dark:text-[#98C379];
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string {
  @apply text-[#0184BC] dark:text-[#56B6C2];
}

.token.atrule,
.token.attr-value,
.token.keyword {
  @apply text-[#A626A4] dark:text-[#C678DD];
}

.token.function,
.token.class-name {
  @apply text-[#4078F2] dark:text-[#61AFEF];
}

.token.regex,
.token.important,
.token.variable {
  @apply text-[#E45649] dark:text-[#E06C75];
}

/* Additional token types for better coverage */
.token.namespace {
  @apply text-[#E45649] dark:text-[#E06C75];
}

.token.parameter {
  @apply text-[#986801] dark:text-[#E5C07B];
}

.token.decorator {
  @apply text-[#D19A66] dark:text-[#D19A66];
}

.token.module {
  @apply text-[#C678DD] dark:text-[#C678DD];
}

.code-highlight {
  @apply bg-muted/30 -mx-4 px-4 border-l-4 border-primary;
}

/* Ensure images don't inherit code styling */
.prose img {
  @apply max-w-full h-auto rounded-lg shadow-md my-8;
  border: none !important;
  padding: 0 !important;
  margin-left: auto;
  margin-right: auto;
}

/* Remove any borders from images in code blocks */
.prose pre img,
.prose code img {
  border: none !important;
  box-shadow: none !important;
}

/* Fix potential white bar issues on images */
.prose p img,
.prose figure img {
  display: block;
  border: none !important;
  outline: none !important;
  background: transparent !important;
}

/* Remove any left padding/margin that might cause white bars */
.prose *:has(> img) {
  padding-left: 0 !important;
  margin-left: 0 !important;
  border-left: none !important;
}

/* Fix blockquote styling - remove default italic and quotes */
.prose blockquote {
  font-style: normal !important;
}

.prose blockquote p {
  font-style: normal !important;
}

.prose blockquote a {
  font-style: normal !important;
}

.prose blockquote strong {
  font-style: normal !important;
  font-weight: bold !important;
}

/* Only apply italic when explicitly marked with em or i tags */
.prose blockquote em,
.prose blockquote i {
  font-style: italic !important;
}

/* Remove quotation marks from blockquotes */
.prose blockquote::before {
  content: none !important;
}

.prose blockquote::after {
  content: none !important;
}

.prose blockquote p::before {
  content: none !important;
}

.prose blockquote p::after {
  content: none !important;
}

.rehype-code-title {
  @apply bg-muted px-4 py-2 font-mono text-sm rounded-t-lg border border-b-0 border-border;
}

/* Mermaid diagram styling */
.mermaid-container {
  @apply w-full;
  min-height: 200px;
}

.mermaid-container svg {
  @apply max-w-full h-auto;
  font-family: ui-monospace, SFMono-Regular, "SF Mono", Consolas, "Liberation Mono", Menlo, monospace;
}

/* Ensure Mermaid text is visible in both light and dark modes */
.mermaid-container text {
  @apply fill-foreground !important;
  fill: hsl(var(--foreground)) !important;
}

.mermaid-container .nodeLabel,
.mermaid-container .edgeLabel,
.mermaid-container .label {
  @apply text-foreground !important;
  color: hsl(var(--foreground)) !important;
}

/* Mermaid node backgrounds */
.mermaid-container .node rect,
.mermaid-container .node circle,
.mermaid-container .node ellipse,
.mermaid-container .node polygon {
  @apply fill-card stroke-border;
  fill: hsl(var(--card)) !important;
  stroke: hsl(var(--border)) !important;
}

/* Mermaid lines and arrows */
.mermaid-container .edgePath path,
.mermaid-container .flowchart-link {
  @apply stroke-muted-foreground;
  stroke: hsl(var(--muted-foreground)) !important;
}

/* Mermaid subgraph backgrounds */
.mermaid-container .cluster rect {
  @apply fill-muted/20 stroke-border;
  fill: hsl(var(--muted) / 0.2) !important;
  stroke: hsl(var(--border)) !important;
}

/* Mermaid subgraph labels */
.mermaid-container .cluster text {
  @apply fill-foreground font-semibold;
  fill: hsl(var(--foreground)) !important;
}

/* Prevent text cutoff in Mermaid nodes */
.mermaid-container .node {
  overflow: visible !important;
}

.mermaid-container .nodeLabel {
  overflow: visible !important;
  white-space: nowrap !important;
}

.mermaid-container foreignObject {
  overflow: visible !important;
}

/* Ensure proper text rendering */
.mermaid-container text {
  font-size: 14px !important;
  font-family: ui-monospace, SFMono-Regular, "SF Mono", Consolas, "Liberation Mono", Menlo, monospace !important;
}