---
title: "Docker ì»¨í…Œì´ë„ˆ í”„ë¡œë•ì…˜ ë°°í¬ ì™„ë²½ ê°€ì´ë“œ"
date: "2025-08-03"
description: "ê°œë°œí•œ Docker ì»¨í…Œì´ë„ˆë¥¼ í”„ë¡œë•ì…˜ í™˜ê²½ì— ì•ˆì „í•˜ê³  íš¨ìœ¨ì ìœ¼ë¡œ ë°°í¬í•˜ëŠ” ë°©ë²•ì„ ë©€í‹° ìŠ¤í…Œì´ì§€ ë¹Œë“œ, AWS ECS, CI/CD íŒŒì´í”„ë¼ì¸ì„ í†µí•´ ì•Œì•„ë´…ë‹ˆë‹¤"
tags: ["Docker", "Deployment", "AWS", "CI/CD", "DevOps"]
category: "DevOps"
series: "Docker ì™„ë²½ ê°€ì´ë“œ"
seriesOrder: 8
---

# Part 8: Docker ì»¨í…Œì´ë„ˆ í”„ë¡œë•ì…˜ ë°°í¬ ì™„ë²½ ê°€ì´ë“œ

ê°œë°œ í™˜ê²½ì—ì„œ ì™„ë²½í•˜ê²Œ ì‘ë™í•˜ëŠ” Docker ì»¨í…Œì´ë„ˆë¥¼ ë§Œë“¤ì—ˆë‹¤ë©´, ì´ì œ í”„ë¡œë•ì…˜ í™˜ê²½ì— ë°°í¬í•  ì°¨ë¡€ì…ë‹ˆë‹¤. ì´ë²ˆ í¬ìŠ¤íŠ¸ì—ì„œëŠ” ë³´ì•ˆ, ì„±ëŠ¥, í™•ì¥ì„±ì„ ê³ ë ¤í•œ í”„ë¡œë•ì…˜ ë°°í¬ ì „ëµì„ ìƒì„¸íˆ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.

## ê°œë°œ vs í”„ë¡œë•ì…˜: í•µì‹¬ ì°¨ì´ì 

í”„ë¡œë•ì…˜ í™˜ê²½ì€ ê°œë°œ í™˜ê²½ê³¼ ê·¼ë³¸ì ìœ¼ë¡œ ë‹¤ë¥¸ ìš”êµ¬ì‚¬í•­ì„ ê°€ì§‘ë‹ˆë‹¤:

| ì¸¡ë©´ | ê°œë°œ í™˜ê²½ | í”„ë¡œë•ì…˜ í™˜ê²½ |
|------|----------|--------------|
| **ì†ŒìŠ¤ ì½”ë“œ** | ë°”ì¸ë“œ ë§ˆìš´íŠ¸ | ì´ë¯¸ì§€ì— í¬í•¨ |
| **ë””ë²„ê¹…** | ìƒì„¸ ë¡œê·¸, ë””ë²„ê·¸ ëª¨ë“œ | ìµœì†Œ ë¡œê·¸, ìµœì í™” ëª¨ë“œ |
| **ì˜ì¡´ì„±** | ê°œë°œ ë„êµ¬ í¬í•¨ | ìµœì†Œí•œì˜ ëŸ°íƒ€ì„ë§Œ |
| **ë³´ì•ˆ** | í¸ì˜ì„± ìš°ì„  | ë³´ì•ˆ ìµœìš°ì„  |
| **ì„±ëŠ¥** | ê°œë°œ í¸ì˜ì„± | ìµœëŒ€ ì„±ëŠ¥ |
| **ì„¤ì •** | í•˜ë“œì½”ë”© ê°€ëŠ¥ | í™˜ê²½ ë³€ìˆ˜ í•„ìˆ˜ |

## ë©€í‹° ìŠ¤í…Œì´ì§€ ë¹Œë“œ ë§ˆìŠ¤í„°í•˜ê¸°

ë©€í‹° ìŠ¤í…Œì´ì§€ ë¹Œë“œëŠ” í”„ë¡œë•ì…˜ ì´ë¯¸ì§€ ìµœì í™”ì˜ í•µì‹¬ì…ë‹ˆë‹¤.

### ê¸°ë³¸ ê°œë…

```dockerfile
# ìŠ¤í…Œì´ì§€ 1: ë¹Œë“œ í™˜ê²½
FROM node:16 AS builder
WORKDIR /app
COPY package*.json ./
RUN npm ci
COPY . .
RUN npm run build

# ìŠ¤í…Œì´ì§€ 2: ëŸ°íƒ€ì„ í™˜ê²½
FROM node:16-alpine
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production
COPY --from=builder /app/dist ./dist
EXPOSE 3000
CMD ["node", "dist/server.js"]
```

### ì‹¤ì „ ì˜ˆì œ: React + Node.js ì• í”Œë¦¬ì¼€ì´ì…˜

```dockerfile
# ========== í”„ë¡ íŠ¸ì—”ë“œ ë¹Œë“œ ìŠ¤í…Œì´ì§€ ==========
FROM node:16 AS frontend-builder
WORKDIR /app/frontend
COPY frontend/package*.json ./
RUN npm ci
COPY frontend/ .
RUN npm run build

# ========== ë°±ì—”ë“œ ë¹Œë“œ ìŠ¤í…Œì´ì§€ ==========
FROM node:16 AS backend-builder
WORKDIR /app/backend
COPY backend/package*.json ./
RUN npm ci
COPY backend/ .
RUN npm run build

# ========== í”„ë¡œë•ì…˜ ìŠ¤í…Œì´ì§€ ==========
FROM node:16-alpine
# ë³´ì•ˆì„ ìœ„í•œ non-root ì‚¬ìš©ì
RUN addgroup -g 1001 -S nodejs
RUN adduser -S nodejs -u 1001

WORKDIR /app

# ë°±ì—”ë“œ ì˜ì¡´ì„± ì„¤ì¹˜
COPY backend/package*.json ./
RUN npm ci --only=production && npm cache clean --force

# ë¹Œë“œëœ íŒŒì¼ ë³µì‚¬
COPY --from=backend-builder --chown=nodejs:nodejs /app/backend/dist ./dist
COPY --from=frontend-builder --chown=nodejs:nodejs /app/frontend/build ./public

# í™˜ê²½ ë³€ìˆ˜
ENV NODE_ENV=production

USER nodejs

EXPOSE 3000

# í—¬ìŠ¤ì²´í¬
HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \
  CMD node healthcheck.js

CMD ["node", "dist/server.js"]
```

### ì´ë¯¸ì§€ í¬ê¸° ìµœì í™” ì „ëµ

#### 1. ì ì ˆí•œ ë² ì´ìŠ¤ ì´ë¯¸ì§€ ì„ íƒ
```dockerfile
# âŒ í° ì´ë¯¸ì§€ (800MB+)
FROM ubuntu:20.04
RUN apt-get update && apt-get install -y nodejs npm

# âœ… ì‘ì€ ì´ë¯¸ì§€ (150MB)
FROM node:16-alpine

# âœ…âœ… ë” ì‘ì€ ì´ë¯¸ì§€ (5MB + ì•±)
FROM alpine:3.14
RUN apk add --no-cache nodejs npm
```

#### 2. ë ˆì´ì–´ ìµœì í™”
```dockerfile
# âŒ ë§ì€ ë ˆì´ì–´
RUN apt-get update
RUN apt-get install -y curl
RUN apt-get install -y git
RUN apt-get clean

# âœ… í•˜ë‚˜ì˜ ë ˆì´ì–´
RUN apt-get update && apt-get install -y \
    curl \
    git \
  && apt-get clean \
  && rm -rf /var/lib/apt/lists/*
```

#### 3. ë¶ˆí•„ìš”í•œ íŒŒì¼ ì œê±°
```dockerfile
# .dockerignore
node_modules
npm-debug.log
.git
.gitignore
README.md
.env
.env.*
.vscode
coverage
.nyc_output
dist
*.map
```

## AWS ECSë¥¼ í™œìš©í•œ ì»¨í…Œì´ë„ˆ ë°°í¬

### ECS ê¸°ë³¸ êµ¬ì„± ìš”ì†Œ

- **Task Definition**: ì»¨í…Œì´ë„ˆ ì‹¤í–‰ ë°©ë²• ì •ì˜
- **Service**: Taskì˜ ì‹¤í–‰ê³¼ ê´€ë¦¬
- **Cluster**: ì»¨í…Œì´ë„ˆê°€ ì‹¤í–‰ë˜ëŠ” ì¸í”„ë¼
- **ECR**: Docker ì´ë¯¸ì§€ ì €ì¥ì†Œ

### Step 1: ECRì— ì´ë¯¸ì§€ í‘¸ì‹œ

```bash
# AWS CLI ì„¤ì •
aws configure

# ECR ë¡œê·¸ì¸
aws ecr get-login-password --region ap-northeast-2 | \
  docker login --username AWS --password-stdin \
  123456789012.dkr.ecr.ap-northeast-2.amazonaws.com

# ì´ë¯¸ì§€ íƒœê¹…
docker tag myapp:latest \
  123456789012.dkr.ecr.ap-northeast-2.amazonaws.com/myapp:latest

# ì´ë¯¸ì§€ í‘¸ì‹œ
docker push \
  123456789012.dkr.ecr.ap-northeast-2.amazonaws.com/myapp:latest
```

### Step 2: Task Definition ìƒì„±

```json
{
  "family": "myapp-task",
  "networkMode": "awsvpc",
  "requiresCompatibilities": ["FARGATE"],
  "cpu": "512",
  "memory": "1024",
  "containerDefinitions": [
    {
      "name": "myapp",
      "image": "123456789012.dkr.ecr.ap-northeast-2.amazonaws.com/myapp:latest",
      "portMappings": [
        {
          "containerPort": 3000,
          "protocol": "tcp"
        }
      ],
      "essential": true,
      "environment": [
        {
          "name": "NODE_ENV",
          "value": "production"
        }
      ],
      "secrets": [
        {
          "name": "DB_PASSWORD",
          "valueFrom": "arn:aws:secretsmanager:region:account-id:secret:db-password"
        }
      ],
      "logConfiguration": {
        "logDriver": "awslogs",
        "options": {
          "awslogs-group": "/ecs/myapp",
          "awslogs-region": "ap-northeast-2",
          "awslogs-stream-prefix": "ecs"
        }
      },
      "healthCheck": {
        "command": ["CMD-SHELL", "curl -f http://localhost:3000/health || exit 1"],
        "interval": 30,
        "timeout": 5,
        "retries": 3,
        "startPeriod": 60
      }
    }
  ]
}
```

### Step 3: Service ìƒì„± ë° ì˜¤í† ìŠ¤ì¼€ì¼ë§

```bash
# ì„œë¹„ìŠ¤ ìƒì„±
aws ecs create-service \
  --cluster myapp-cluster \
  --service-name myapp-service \
  --task-definition myapp-task:1 \
  --desired-count 2 \
  --launch-type FARGATE \
  --network-configuration "awsvpcConfiguration={
    subnets=[subnet-xxx,subnet-yyy],
    securityGroups=[sg-xxx],
    assignPublicIp=ENABLED
  }"

# ì˜¤í† ìŠ¤ì¼€ì¼ë§ ì„¤ì •
aws application-autoscaling register-scalable-target \
  --service-namespace ecs \
  --resource-id service/myapp-cluster/myapp-service \
  --scalable-dimension ecs:service:DesiredCount \
  --min-capacity 2 \
  --max-capacity 10

# CPU ê¸°ë°˜ ìŠ¤ì¼€ì¼ë§ ì •ì±…
aws application-autoscaling put-scaling-policy \
  --service-namespace ecs \
  --scalable-dimension ecs:service:DesiredCount \
  --resource-id service/myapp-cluster/myapp-service \
  --policy-name cpu-scaling-policy \
  --policy-type TargetTrackingScaling \
  --target-tracking-scaling-policy-configuration '{
    "TargetValue": 70.0,
    "PredefinedMetricSpecification": {
      "PredefinedMetricType": "ECSServiceAverageCPUUtilization"
    }
  }'
```

## GitHub Actions CI/CD íŒŒì´í”„ë¼ì¸

### .github/workflows/deploy.yml
```yaml
name: Deploy to Production

on:
  push:
    branches: [main]

env:
  AWS_REGION: ap-northeast-2
  ECR_REPOSITORY: myapp
  ECS_SERVICE: myapp-service
  ECS_CLUSTER: myapp-cluster
  ECS_TASK_DEFINITION: task-definition.json

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '16'
          
      - name: Install dependencies
        run: npm ci
        
      - name: Run tests
        run: npm test
        
      - name: Run linting
        run: npm run lint

  build-and-deploy:
    needs: test
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Configure AWS credentials
        uses: aws-actions/configure-aws-credentials@v1
        with:
          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          aws-region: ${{ env.AWS_REGION }}
      
      - name: Login to Amazon ECR
        id: login-ecr
        uses: aws-actions/amazon-ecr-login@v1
      
      - name: Build, tag, and push image to Amazon ECR
        id: build-image
        env:
          ECR_REGISTRY: ${{ steps.login-ecr.outputs.registry }}
          IMAGE_TAG: ${{ github.sha }}
        run: |
          docker build -t $ECR_REGISTRY/$ECR_REPOSITORY:$IMAGE_TAG .
          docker push $ECR_REGISTRY/$ECR_REPOSITORY:$IMAGE_TAG
          echo "image=$ECR_REGISTRY/$ECR_REPOSITORY:$IMAGE_TAG" >> $GITHUB_OUTPUT
      
      - name: Fill in the new image ID in the Amazon ECS task definition
        id: task-def
        uses: aws-actions/amazon-ecs-render-task-definition@v1
        with:
          task-definition: ${{ env.ECS_TASK_DEFINITION }}
          container-name: myapp
          image: ${{ steps.build-image.outputs.image }}
      
      - name: Deploy Amazon ECS task definition
        uses: aws-actions/amazon-ecs-deploy-task-definition@v1
        with:
          task-definition: ${{ steps.task-def.outputs.task-definition }}
          service: ${{ env.ECS_SERVICE }}
          cluster: ${{ env.ECS_CLUSTER }}
          wait-for-service-stability: true
      
      - name: Slack Notification
        if: always()
        uses: 8398a7/action-slack@v3
        with:
          status: ${{ job.status }}
          text: 'Deployment ${{ job.status }}'
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK }}
```

## ë³´ì•ˆ ëª¨ë²” ì‚¬ë¡€

### 1. ì´ë¯¸ì§€ ìŠ¤ìº”

```bash
# Dockerfileì— ë³´ì•ˆ ìŠ¤ìº” ì¶”ê°€
FROM alpine:3.14
RUN apk add --no-cache ca-certificates

# ì·¨ì•½ì  ìŠ¤ìº”
docker scan myapp:latest
```

### 2. ì‹œí¬ë¦¿ ê´€ë¦¬

```yaml
# âŒ í•˜ë“œì½”ë”©ëœ ì‹œí¬ë¦¿
ENV DB_PASSWORD=mysecretpassword

# âœ… ëŸ°íƒ€ì„ ì‹œ ì£¼ì…
ENV DB_PASSWORD_FILE=/run/secrets/db_password
```

### 3. ìµœì†Œ ê¶Œí•œ ì›ì¹™

```dockerfile
# Non-root ì‚¬ìš©ì ì‹¤í–‰
FROM node:16-alpine
RUN addgroup -g 1001 -S nodejs && \
    adduser -S nodejs -u 1001
USER nodejs

# ì½ê¸° ì „ìš© íŒŒì¼ì‹œìŠ¤í…œ
# docker run --read-only myapp
```

### 4. ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆ

```yaml
# Security Group ì„¤ì •
SecurityGroup:
  Type: AWS::EC2::SecurityGroup
  Properties:
    GroupDescription: ECS Security Group
    SecurityGroupIngress:
      - IpProtocol: tcp
        FromPort: 443
        ToPort: 443
        CidrIp: 0.0.0.0/0
    SecurityGroupEgress:
      - IpProtocol: tcp
        FromPort: 0
        ToPort: 65535
        CidrIp: 10.0.0.0/16  # VPC ë‚´ë¶€ë§Œ
```

## ëª¨ë‹ˆí„°ë§ê³¼ ë¡œê¹…

### 1. CloudWatch í†µí•©

```json
{
  "logConfiguration": {
    "logDriver": "awslogs",
    "options": {
      "awslogs-group": "/ecs/myapp",
      "awslogs-region": "ap-northeast-2",
      "awslogs-stream-prefix": "ecs",
      "awslogs-datetime-format": "%Y-%m-%d %H:%M:%S"
    }
  }
}
```

### 2. ì»¤ìŠ¤í…€ ë©”íŠ¸ë¦­

```javascript
// CloudWatch ë©”íŠ¸ë¦­ ì „ì†¡
const AWS = require('aws-sdk');
const cloudwatch = new AWS.CloudWatch();

function sendMetric(metricName, value, unit = 'Count') {
  const params = {
    Namespace: 'MyApp',
    MetricData: [
      {
        MetricName: metricName,
        Value: value,
        Unit: unit,
        Timestamp: new Date()
      }
    ]
  };
  
  cloudwatch.putMetricData(params, (err, data) => {
    if (err) console.error('Metric error:', err);
  });
}

// ì‚¬ìš© ì˜ˆ
sendMetric('RequestCount', 1);
sendMetric('ResponseTime', 150, 'Milliseconds');
```

### 3. ì•ŒëŒ ì„¤ì •

```bash
# CPU ì‚¬ìš©ë¥  ì•ŒëŒ
aws cloudwatch put-metric-alarm \
  --alarm-name cpu-alarm \
  --alarm-description "Alarm when CPU exceeds 80%" \
  --metric-name CPUUtilization \
  --namespace AWS/ECS \
  --statistic Average \
  --period 300 \
  --threshold 80 \
  --comparison-operator GreaterThanThreshold \
  --evaluation-periods 2
```

## ë¡¤ë§ ì—…ë°ì´íŠ¸ì™€ ë¸”ë£¨/ê·¸ë¦° ë°°í¬

### ë¡¤ë§ ì—…ë°ì´íŠ¸

```json
{
  "deploymentConfiguration": {
    "maximumPercent": 200,
    "minimumHealthyPercent": 100,
    "deploymentCircuitBreaker": {
      "enable": true,
      "rollback": true
    }
  }
}
```

### ë¸”ë£¨/ê·¸ë¦° ë°°í¬ (CodeDeploy)

```yaml
# appspec.yml
version: 0.0
Resources:
  - TargetService:
      Type: AWS::ECS::Service
      Properties:
        TaskDefinition: "myapp-task:blue"
        LoadBalancerInfo:
          ContainerName: "myapp"
          ContainerPort: 3000
```

## ë¹„ìš© ìµœì í™”

### 1. ì ì ˆí•œ ë¦¬ì†ŒìŠ¤ í• ë‹¹

```json
{
  "cpu": "256",    // 0.25 vCPU
  "memory": "512"  // 512 MB
}
```

### 2. Spot ì¸ìŠ¤í„´ìŠ¤ í™œìš©

```bash
aws ecs put-cluster-capacity-providers \
  --cluster myapp-cluster \
  --capacity-providers FARGATE FARGATE_SPOT \
  --default-capacity-provider-strategy \
    capacityProvider=FARGATE,weight=1 \
    capacityProvider=FARGATE_SPOT,weight=4
```

### 3. ìë™ ìŠ¤ì¼€ì¼ë§ ìµœì í™”

```json
{
  "TargetValue": 70.0,
  "ScaleInCooldown": 300,
  "ScaleOutCooldown": 60
}
```

## ì²´í¬ë¦¬ìŠ¤íŠ¸

í”„ë¡œë•ì…˜ ë°°í¬ ì „ í™•ì¸ì‚¬í•­:

- [ ] ë©€í‹° ìŠ¤í…Œì´ì§€ ë¹Œë“œë¡œ ì´ë¯¸ì§€ ìµœì í™”
- [ ] ë³´ì•ˆ ìŠ¤ìº” í†µê³¼
- [ ] Non-root ì‚¬ìš©ì ì‹¤í–‰
- [ ] í—¬ìŠ¤ì²´í¬ êµ¬í˜„
- [ ] í™˜ê²½ ë³€ìˆ˜ë¡œ ì„¤ì • ê´€ë¦¬
- [ ] ì‹œí¬ë¦¿ ì•ˆì „í•˜ê²Œ ì €ì¥
- [ ] ë¡œê¹… ì„¤ì • ì™„ë£Œ
- [ ] ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ êµ¬ì„±
- [ ] ì•ŒëŒ ì„¤ì •
- [ ] ë°±ì—… ì „ëµ ìˆ˜ë¦½
- [ ] ë¡¤ë°± ê³„íš ì¤€ë¹„
- [ ] ë¶€í•˜ í…ŒìŠ¤íŠ¸ ì™„ë£Œ

## ë§ˆë¬´ë¦¬

Docker ì»¨í…Œì´ë„ˆì˜ í”„ë¡œë•ì…˜ ë°°í¬ëŠ” ë‹¨ìˆœíˆ ì½”ë“œë¥¼ ì„œë²„ì— ì˜¬ë¦¬ëŠ” ê²ƒ ì´ìƒì˜ ì˜ë¯¸ë¥¼ ê°€ì§‘ë‹ˆë‹¤. ë³´ì•ˆ, ì„±ëŠ¥, ì•ˆì •ì„±, í™•ì¥ì„±ì„ ëª¨ë‘ ê³ ë ¤í•´ì•¼ í•˜ëŠ” ë³µì¡í•œ ê³¼ì •ì…ë‹ˆë‹¤.

ì´ ì‹œë¦¬ì¦ˆë¥¼ í†µí•´ Dockerì˜ ê¸°ì´ˆë¶€í„° í”„ë¡œë•ì…˜ ë°°í¬ê¹Œì§€ ì „ ê³¼ì •ì„ ë‹¤ë¤˜ìŠµë‹ˆë‹¤. ì´ì œ ì—¬ëŸ¬ë¶„ì€ Dockerë¥¼ í™œìš©í•´ í˜„ëŒ€ì ì´ê³  í™•ì¥ ê°€ëŠ¥í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ êµ¬ì¶•í•˜ê³  ë°°í¬í•  ìˆ˜ ìˆëŠ” ëª¨ë“  ì§€ì‹ì„ ê°–ì¶”ì—ˆìŠµë‹ˆë‹¤.

DockerëŠ” ê³„ì† ë°œì „í•˜ê³  ìˆìŠµë‹ˆë‹¤. Kubernetes, Service Mesh, Serverless ì»¨í…Œì´ë„ˆ ë“± ë” ë§ì€ ì£¼ì œë“¤ì´ ê¸°ë‹¤ë¦¬ê³  ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì´ ì‹œë¦¬ì¦ˆì—ì„œ ë‹¤ë£¬ ê¸°ì´ˆê°€ íƒ„íƒ„í•˜ë‹¤ë©´, ì–´ë–¤ ìƒˆë¡œìš´ ê¸°ìˆ ë„ ì‰½ê²Œ ìµí ìˆ˜ ìˆì„ ê²ƒì…ë‹ˆë‹¤.

Happy Dockerizing! ğŸ³

---

**ì‹œë¦¬ì¦ˆ ë„¤ë¹„ê²Œì´ì…˜**
- â† ì´ì „: [Part 7: Laravel & PHP with Docker](/posts/docker-laravel-php)
- â†’ ì‹œë¦¬ì¦ˆ ì™„ê²°